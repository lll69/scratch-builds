(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([["addon-entry-mediarecorder"],{"./node_modules/css-loader/index.js!./src/addons/addons/mediarecorder/style.css":
/*!*****************************************************************************!*\
  !*** ./node_modules/css-loader!./src/addons/addons/mediarecorder/style.css ***!
  \*****************************************************************************/
/*! no static exports found */function(e,t,n){(e.exports=n(/*! ../../../../node_modules/css-loader/lib/css-base.js */"./node_modules/css-loader/lib/css-base.js")(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopupContent {\n  padding: 1.5rem 2.25rem;\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 0.5rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\np.mediaRecorderPopupOption {\n  display: flex;\n  align-items: center;\n}\n\n.mediaRecorderPopupOption input[type="checkbox"] {\n  height: 1.5rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n/* TW: Fixes cancel button in dark mode */\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},"./src/addons/addons/mediarecorder/_runtime_entry.js":
/*!***********************************************************!*\
  !*** ./src/addons/addons/mediarecorder/_runtime_entry.js ***!
  \***********************************************************/
/*! exports provided: resources */function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return d}));var o=n(/*! ./userscript.js */"./src/addons/addons/mediarecorder/userscript.js"),a=n(/*! css-loader!./style.css */"./node_modules/css-loader/index.js!./src/addons/addons/mediarecorder/style.css"),r=n.n(a);const d={"userscript.js":o.default,"style.css":r.a}},"./src/addons/addons/mediarecorder/userscript.js":
/*!*******************************************************!*\
  !*** ./src/addons/addons/mediarecorder/userscript.js ***!
  \*******************************************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t);var o=n(/*! ../../libraries/common/cs/download-blob.js */"./src/addons/libraries/common/cs/download-blob.js");t.default=async({addon:e,console:t,msg:n})=>{let a,r,d,c=!1,i=!1,s=null,l=null,p=null,m=[];for(;;){const u=await e.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),b=()=>{const{backdrop:t,container:o,content:a,closeButton:r,remove:d}=e.tab.createModal(n("option-title"),{isOpen:!0,useEditorClasses:!0});o.classList.add("mediaRecorderPopup"),a.classList.add("mediaRecorderPopupContent"),a.appendChild(Object.assign(document.createElement("p"),{textContent:n("record-description"),className:"recordOptionDescription"}));const c=document.createElement("p"),i=Object.assign(document.createElement("input"),{type:"number",min:1,max:300,defaultValue:30,id:"recordOptionSecondsInput",className:e.tab.scratchClass("prompt_variable-name-text-input")}),s=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:n("record-duration")});c.appendChild(s),c.appendChild(i),a.appendChild(c);const l=document.createElement("p"),p=Object.assign(document.createElement("input"),{type:"number",min:0,max:300,defaultValue:0,id:"recordOptionDelayInput",className:e.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:n("start-delay")});l.appendChild(m),l.appendChild(p),a.appendChild(l);const u=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),b=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),h=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:n("record-audio"),title:n("record-audio-description")});u.appendChild(b),u.appendChild(h),a.appendChild(u);const g=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),O=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),C=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:n("record-mic")});g.appendChild(O),g.appendChild(C),a.appendChild(g);const E=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),f=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),w=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:n("record-after-flag")});E.appendChild(f),E.appendChild(w),a.appendChild(E);const v=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),x=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),k=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:n("record-until-stop")});f.addEventListener("change",()=>{(x.disabled=!f.checked)&&(k.title=n("record-until-stop-disabled",{afterFlagOption:n("record-after-flag")}))}),v.appendChild(x),v.appendChild(k),a.appendChild(v);let j=null;const y=new Promise(e=>{j=e});let R=null;t.addEventListener("click",()=>R(null)),r.addEventListener("click",()=>R(null)),R=e=>{j(e),d()};const P=Object.assign(document.createElement("div"),{className:e.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),S=Object.assign(document.createElement("button"),{textContent:n("cancel")});S.addEventListener("click",()=>R(null),{once:!0}),P.appendChild(S);const T=Object.assign(document.createElement("button"),{textContent:n("start"),className:e.tab.scratchClass("prompt_ok-button")});return T.addEventListener("click",()=>R({secs:Number(i.value),delay:Number(p.value),audioEnabled:b.checked,micEnabled:O.checked,waitUntilFlag:f.checked,useStopSign:!x.disabled&&x.checked}),{once:!0}),P.appendChild(T),a.appendChild(P),y},h=()=>{c=!1,a.textContent=n("record"),a.title="",r=null,m=[],clearTimeout(d),d=0,p&&(e.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",p),p=null)},g=t=>{if(i)return e.tab.traps.vm.runtime.off("PROJECT_START",s),i=!1,s=null,l.abort(),l=null,void h();c&&r&&"inactive"!==r.state&&(t?h():(r.onstop=()=>{const e=new Blob(m,{type:"video/webm"});Object(o.default)("video.webm",e),h()},r.stop()))},O=async o=>{const u=Math.min(300,Math.max(1,o.secs));m=[],c=!0;const b=e.tab.traps.vm;let h;if(o.micEnabled)try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){if("NotAllowedError"!==e.name&&"NotFoundError"!==e.name)throw e;o.micEnabled=!1}if(o.waitUntilFlag){i=!0,Object.assign(a,{textContent:n("click-flag"),title:n("click-flag-description")}),l=new AbortController;try{await Promise.race([new Promise(e=>{s=()=>e(),b.runtime.once("PROJECT_START",s)}),new Promise((e,t)=>{l.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}i=!1,s=l=null;const O=new MediaStream,C=b.runtime.renderer.canvas.captureStream();O.addTrack(C.getVideoTracks()[0]);const E=new AudioContext,f=E.createMediaStreamDestination();if(o.audioEnabled){const e=b.runtime.audioEngine.audioContext.createMediaStreamDestination();b.runtime.audioEngine.inputNode.connect(e);E.createMediaStreamSource(e.stream).connect(f)}if(o.micEnabled){E.createMediaStreamSource(h).connect(f)}(o.audioEnabled||o.micEnabled)&&O.addTrack(f.stream.getAudioTracks()[0]),r=new MediaRecorder(O,{mimeType:"video/webm"}),r.ondataavailable=e=>{m.push(e.data)},r.onerror=e=>{t.warn("Recorder error:",e.error),g(!0)},d=setTimeout(()=>g(!1),1e3*u),o.useStopSign&&(p=()=>g(),b.runtime.once("PROJECT_STOP_ALL",p));const w=o.delay||0,v=Math.floor(w);for(let e=0;e<v;e++)a.textContent=n("starting-in",{secs:v-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{a.textContent=n("stop"),r.start(1e3)},1e3*(w-v))};a||(a=Object.assign(document.createElement("div"),{className:"sa-record "+u.className,textContent:n("record")}),a.addEventListener("click",async()=>{if(c)g();else{const e=await b();if(!e)return void t.log("Canceled");O(e)}})),u.parentElement.appendChild(a)}}},"./src/addons/libraries/common/cs/download-blob.js":
/*!*********************************************************!*\
  !*** ./src/addons/libraries/common/cs/download-blob.js ***!
  \*********************************************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t),t.default=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const o=window.URL.createObjectURL(t);n.href=o,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(o)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}}}]);